# Multi-stage build for React frontend\nFROM node:18-alpine AS builder\n\n# Set working directory\nWORKDIR /app\n\n# Copy package files\nCOPY package.json package-lock.json* ./\n\n# Install dependencies\nRUN npm ci\n\n# Copy source code\nCOPY . .\n\n# Build the React app\nRUN npm run build\n\n# Production stage with nginx\nFROM nginx:alpine AS production\n\n# Copy built app from builder stage\nCOPY --from=builder /app/build /usr/share/nginx/html\n\n# Copy custom nginx configuration\nCOPY nginx.conf /etc/nginx/nginx.conf\n\n# Create non-root user\nRUN addgroup -g 1001 -S nginx\nRUN adduser -S nginx -u 1001\n\n# Change ownership\nRUN chown -R nginx:nginx /usr/share/nginx/html\nRUN chown -R nginx:nginx /var/cache/nginx\nRUN chown -R nginx:nginx /var/log/nginx\nRUN chown -R nginx:nginx /etc/nginx/conf.d\nRUN touch /var/run/nginx.pid\nRUN chown -R nginx:nginx /var/run/nginx.pid\n\n# Switch to non-root user\nUSER nginx\n\n# Expose port\nEXPOSE 3000\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \\\n  CMD curl -f http://localhost:3000 || exit 1\n\n# Start nginx\nCMD [\"nginx\", \"-g\", \"daemon off;\"]"